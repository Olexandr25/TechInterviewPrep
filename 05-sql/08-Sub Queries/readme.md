# Sub Queries

**Subqueries** (підзапити, вкладені запити, inner queries) — це SQL-запити, які розміщуються всередині іншого запиту. Вони дозволяють розбивати складні запити на простіші частини, створювати динамічні умови, виконувати обчислення або порівнювати множини результатів. Підзапити можуть використовуватись у SELECT, FROM, WHERE, HAVING та інших частинах SQL-запиту.

---

## Основні поняття

- **Table (Таблиця)**
  Основна структура для організації даних у реляційній базі. Складається з рядків (records) і стовпців (fields). Визначає схему даних, типи та обмеження.

- **Row (Рядок, запис, tuple)**
  Окремий запис у таблиці, що містить значення для кожного стовпця. Операції INSERT, UPDATE, DELETE працюють на рівні рядків.

- **Column (Стовпець)**
  Категорія даних у таблиці. Кожен стовпець має певний тип даних і обмеження. Вибір правильного типу важливий для цілісності та продуктивності.

- **Scalar (Скалярне значення)**
  Одиничне значення (не масив, не множина). Скалярний підзапит повертає одне значення (один рядок, один стовпець). Скалярні функції також повертають одне значення.

---

## Види підзапитів

- **Звичайний підзапит (Nested Subquery)**
  Підзапит, вкладений у основний запит. Може бути у SELECT, WHERE, FROM, HAVING тощо.

  ```sql
  SELECT name
  FROM employees
  WHERE department_id IN (
    SELECT id FROM departments WHERE location = 'Kyiv'
  );
  ```

- **Скалярний підзапит (Scalar Subquery)**
  Повертає одне значення (один рядок, один стовпець). Може використовуватись у SELECT або WHERE.

  ```sql
  SELECT name,
         (SELECT MAX(salary) FROM employees) AS max_salary
  FROM employees;
  ```

- **Вкладені підзапити (Nested Subqueries)**
  Підзапит всередині іншого підзапиту. Дозволяє будувати складні багаторівневі умови.

  ```sql
  SELECT name
  FROM employees
  WHERE department_id IN (
    SELECT id FROM departments
    WHERE location_id IN (
      SELECT id FROM locations WHERE country = 'Ukraine'
    )
  );
  ```

- **Корельований підзапит (Correlated Subquery)**
  Підзапит, який використовує значення з зовнішнього запиту. Виконується для кожного рядка зовнішнього запиту.

  ```sql
  SELECT name
  FROM employees e
  WHERE salary > (
    SELECT AVG(salary)
    FROM employees
    WHERE department_id = e.department_id
  );
  ```

  - Не може виконуватись окремо від зовнішнього запиту.

---

## Interview Questions

- Що таке підзапит (subquery) у SQL?
- Де можна використовувати підзапити?
- Чим відрізняється скалярний підзапит від звичайного?
- Що таке корельований підзапит? Наведіть приклад.
- Як працюють вкладені підзапити?
- Які переваги та недоліки підзапитів у порівнянні з JOIN?

---

## What to Answer

- Підзапит — це запит всередині іншого SQL-запиту.
- Можна використовувати у SELECT, FROM, WHERE, HAVING.
- Скалярний підзапит повертає одне значення.
- Корельований підзапит залежить від зовнішнього запиту, виконується для кожного рядка.
- Вкладені підзапити дозволяють будувати складні багаторівневі умови.
- Підзапити зручні для розбиття складних задач, але іноді JOIN-и працюють швидше.
