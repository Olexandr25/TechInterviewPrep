# Performance Optimization

**Performance optimization** в SQL — це набір практик для підвищення швидкості виконання запитів і загальної продуктивності бази даних. Основні стратегії: використання індексів, оптимізація структури запитів, уникнення SELECT *, мінімізація JOIN-ів, використання LIMIT/OFFSET, аналіз плану виконання (EXPLAIN), регулярне обслуговування індексів і статистики.

---

## Query Analysis Techniques

- **EXPLAIN / EXPLAIN PLAN** — показує, як СУБД виконує запит: які індекси використовуються, порядок з'єднання таблиць, типи JOIN-ів, кількість рядків тощо.

  ```sql
  EXPLAIN SELECT ... FROM ... WHERE ...;
  ```

- **Профілювання запитів** — вимірювання часу виконання, аналіз використання ресурсів.
- **Аналіз індексів** — перевірка, чи використовуються індекси для фільтрації та з'єднання.
- **Рефакторинг складних запитів** — розбиття на простіші, використання CTE (WITH ...), тимчасових таблиць.

---

## Using Indexes

- **Індекси** прискорюють пошук і вибірку, особливо у великих таблицях.
- Види: B-tree (стандартний), bitmap, full-text.
- Індексувати варто стовпці, які часто використовуються у WHERE, JOIN, ORDER BY.
- Індекси прискорюють SELECT, але можуть уповільнювати INSERT/UPDATE/DELETE.
- Перевірити використання індексу можна через EXPLAIN.

---

## Optimizing Joins

- Використовуйте **явний JOIN** (INNER/LEFT/RIGHT/FULL) замість неявного (через WHERE).
- Індексувати стовпці, які використовуються у ON.
- Фільтруйте дані у WHERE до JOIN-у, якщо можливо.
- Уникайте зайвих JOIN-ів — підключайте лише потрібні таблиці.
- Вибирайте лише потрібні стовпці (уникайте SELECT *).
- Аналізуйте план виконання для складних запитів з кількома JOIN-ами.

---

## Reducing Subqueries

- Замінюйте корельовані підзапити на JOIN, якщо це можливо.
- Для повторно використовуваних підзапитів використовуйте CTE (WITH ...).
- Обмежуйте кількість рядків, які повертає підзапит.
- Для складних підзапитів можна використовувати тимчасові таблиці.

---

## Selective Projection

- Завжди вказуйте лише потрібні стовпці у SELECT (наприклад, `SELECT name, age` замість `SELECT *`).
- Це зменшує обсяг переданих даних і прискорює виконання запиту.

---

## Інші поради

- **LIMIT/OFFSET** — обмежуйте кількість рядків, які повертає запит.
- **EXISTS замість IN** — для перевірки наявності записів часто швидше.
- **Регулярно оновлюйте статистику та перебудовуйте індекси**.
- **Використовуйте партиціювання** для великих таблиць.
- **Моніторинг** — відстежуйте час виконання, навантаження на CPU, пам'ять, диск.

---

## Interview Questions

- Як перевірити, чому запит працює повільно?
- Для чого потрібен EXPLAIN?
- Як індекси впливають на продуктивність?
- Як оптимізувати запити з кількома JOIN-ами?
- Чому не варто використовувати SELECT *?
- Як зменшити кількість підзапитів?
- Які ще способи оптимізації SQL-запитів ви знаєте?

---

## What to Answer

- Аналізуйте запити через EXPLAIN/EXPLAIN PLAN.
- Індексувати часто використовувані стовпці.
- Уникайте SELECT *, вибирайте лише потрібні поля.
- Мінімізуйте кількість JOIN-ів і підзапитів.
- Використовуйте LIMIT/OFFSET для великих вибірок.
- Регулярно обслуговуйте індекси та оновлюйте статистику.
- Використовуйте EXISTS замість IN для перевірки наявності.
- Моніторинг і профілювання — ключ до виявлення вузьких місць.
