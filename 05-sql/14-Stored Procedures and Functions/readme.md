# Stored Procedures and Functions

**Stored procedures** та **functions** — це збережені об'єкти бази даних, які містять набір SQL-операторів і логіку. Вони дозволяють інкапсулювати бізнес-логіку, повторно використовувати код, зменшувати мережевий трафік і підвищувати безпеку, оскільки приховують деталі реалізації від користувача.

---

## Stored Procedure vs Function

| Характеристика         | Stored Procedure                         | Function                              |
|------------------------|------------------------------------------|---------------------------------------|
| Повертає значення      | Може повертати кілька значень (OUT/INOUT)| Повертає одне значення (RETURN)       |
| Виклик у SQL           | CALL/EXECUTE                             | SELECT або у виразах                  |
| Може змінювати дані    | Так (INSERT, UPDATE, DELETE)             | Зазвичай ні (тільки SELECT/обчислення)|
| Використання у SELECT  | Ні                                       | Так                                   |
| Параметри              | IN, OUT, INOUT                           | Тільки IN                             |
| Транзакції             | Може містити                             | Зазвичай не містить                   |

---

## Приклад створення процедури

```sql
CREATE PROCEDURE add_student(IN name TEXT, IN email TEXT)
BEGIN
    INSERT INTO students (name, email) VALUES (name, email);
END;
```

Виклик:

```sql
CALL add_student('Ivan', 'ivan@email.com');
```

---

## Приклад створення функції

```sql
CREATE FUNCTION get_student_email(student_id INT)
RETURNS TEXT
AS $$
    SELECT email FROM students WHERE id = student_id;
$$ LANGUAGE SQL;
```

Виклик:

```sql
SELECT get_student_email(1);
```

---

## Переваги використання

- Інкапсуляція бізнес-логіки на рівні БД
- Повторне використання коду
- Зменшення мережевого трафіку
- Підвищення безпеки (обмеження прямого доступу до таблиць)

---

## Interview Questions

- Що таке stored procedure та function у SQL?
- Чим відрізняється процедура від функції?
- Як створити, змінити або видалити процедуру/функцію?
- Які переваги використання stored procedures/functions?
- Як передавати параметри у процедури та функції?
- Чи можна викликати функцію у SELECT? А процедуру?

---

## What to Answer

- **Що таке stored procedure та function у SQL?**
  - Stored procedure — це збережений набір SQL-операцій, який можна викликати як одну команду для виконання складної логіки чи маніпуляцій з даними.
  - Function — це збережений об'єкт, який повертає одне значення і може використовуватись у SELECT або виразах.

- **Чим відрізняється процедура від функції?**
  - Процедура може повертати кілька значень (через OUT/INOUT), може змінювати дані, викликається через CALL/EXECUTE, не використовується у SELECT.
  - Функція повертає одне значення (через RETURN), зазвичай не змінює дані, може використовуватись у SELECT, приймає лише IN-параметри.

- **Як створити, змінити або видалити процедуру/функцію?**
  - Створити: `CREATE PROCEDURE ...` або `CREATE FUNCTION ...`
  - Змінити: `ALTER PROCEDURE ...` / `ALTER FUNCTION ...` (або DROP і CREATE заново, залежно від СУБД)
  - Видалити: `DROP PROCEDURE ...` / `DROP FUNCTION ...`

- **Які переваги використання stored procedures/functions?**
  - Інкапсуляція бізнес-логіки на рівні БД.
  - Повторне використання коду.
  - Зменшення мережевого трафіку (менше запитів).
  - Підвищення безпеки (обмеження прямого доступу до таблиць).

- **Як передавати параметри у процедури та функції?**
  - У процедури: IN, OUT, INOUT параметри.
  - У функції: тільки IN параметри.

- **Чи можна викликати функцію у SELECT? А процедуру?**
  - Функцію — так, можна у SELECT або у виразах.

    ```sql
    SELECT get_student_email(1);
    ```

  - Процедуру — ні, її викликають через CALL/EXECUTE, не у SELECT.

    ```sql
    CALL add_student('Ivan', 'ivan@email.com');
    ```
